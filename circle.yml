# https://circleci.com/gh/Llamatech/review-me

machine:
  hosts:
    review-me.margffoy-tuay.com: 127.0.0.1:3000
  environment:
    # For Coveralls
    COVERALLS_REPO_TOKEN: hUyo0WxL7HxdL0tmwqpyKZAwJf4qlWujf
    MONGO_URL: mongodb://127.0.0.1:27017
    ROOT_URL: http://review-me.margffoy-tuay.com
  services:
    - mongod
  pre:
    - meteor || curl https://install.meteor.com | /bin/sh
  post:
    - meteor --version

dependencies:
  override:
    - meteor npm install

test:
  override:
    - echo $METEOR_SETTINGS > settings-development.json
    - ./node_modules/.bin/eslint .:
        parallel: true
    # - meteor test --once --driver-package dispatch:mocha:
    #     parallel: true
    - awk 'NR==20 {$0="\047phantomjs-options\047: \047--load-images=no --ssl-protocol=TLSv1 --debug=true --remote-debugger-port=9000 --remote-debugger-autorun=yes \047"} { print }' node_modules/spacejam/lib/Spacejam.coffee && timeout 240s meteor npm run coverage-app-unit:
        parallel: true
    - cat .coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js || true

